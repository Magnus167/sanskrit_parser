# -*- coding: utf-8 -*-
# Sutras for ac sandhi
#  @author: kmadathil

# Preefined variables, can be used as lvalues and rvalues in xform and
# lvalues in conditions. To use a variable as rvalue in a condition,
# prefix with $ (eg l: $r checkes for savarnatva between l and r)
#
#   lp = left pada
#   rp = right pada
#   l = last varna of left pada
#   r = first varna of right pada
#  ll = second last varna of left pada
#  rr = second varna of right pada
#  lc = left pada except last varna
#  rc = right pada except first varna

# Sutra: Name
# Id: <adhyAya.pAda.sutra>
# Condition: boolean
# Every boolean is a(n or reduced list of) var: <value> and conditions
#     l: a - l is savarna of a varna
#     l: ut - l is short u varna
#     r: ku - l is kavarga
#     r: _ac - r is in pratyahara "ac"
#     r: $l  - r is savarna of l (variable)
#    rp: =naam - rp is exactly the string "naam"
#
# Trigger: (list of) global triggers needed to enable this rule
#
# Xform: dict of transformations. Each transformation is a python expression
#    l: dirgha(l)
#    r: ""
# 
# Update:
#   lp: +ru - sets tag "ru" on lp
#   rp: -pada - removes "pada" tag from rp
#   trigger: - sets triggers
#     uran_trigger:   - sets trigger uran_trigger 
#         value: True - to True
#           condition:  - if
#              r: f       - r = "f"

# ac sandhi

# FIXME PurvaparayoH needs a bit more thought
-   sutra: आद्गुणः
    id: 6.1.87
    condition:
       l: a
       r: _ik
    xform:
       l: guna(r)
       r: null
    trigger: null
    update:
      trigger:
        uran_trigger:
          value: True
          condition:
             r: f

-   sutra: वृद्धिरेचि
    id: 6.1.88
    condition:
       l: a
       r: _ec
    xform:
       l: vriddhi(r)
       r: null
    trigger: null
    update: null
             
-   sutra: उरण् रपरः
    id: 1.1.51
    condition: null
    xform:
       r: str("r")+r
    trigger: uran_trigger 
    update:
      trigger:
        uran_trigger:
          value: False

-   sutra: इको यणचि
    id: 6.1.77
    condition:
      l: _ik
      r: _ac
    xform:
      l: ikoyan(l)
       
-   sutra: एचोऽयवायावः
    id: 6.1.78
    condition:
      l: _ec
      r: _ac
    xform:
       l: ayavayav(l)
       
-   sutra: अकः सवर्णे दीर्घः
    id: 6.1.101
    condition:
      l: _ak
      r: $l
    xform:
      l: dirgha(l)
      r: null

-   sutra: एङः पदान्तादति
    id: 6.1.109
    condition:
      l: _eN
      r: at
      lp: ?pada
    xform:
      r: null

# hal sandhi

- sutra: स्तोः श्चुना श्चुः
  id: 8.4.40
  condition:
      - l: [s, tu]
        r: [S, cu]
      - l: [S, cu]
        r: [s, tu]
  xform:
      r: shcutva(r)
      l: shcutva(l)

- sutra: ष्टुना ष्टुः
  id: 8.4.41
  condition:
      - l: [s, tu]
        r: [z, wu]
      - l: [z, wu]
        r: [s, tu]
  xform:
      r: zwutva(r)
      l: zwutva(l)

- sutra: न पदान्ताट्टोरनाम्
  id: 8.4.42
  overrides: 8.4.41
  condition:
      - lp: ?pada
        l: wu
        r: [s, tu]
  xform:

# Subsutra plus vArtikas
- sutra: न पदान्ताट्टोरनाम्
  id: 8.4.42.1
  overrides: [8.4.42, 8.4.41]
  condition:
      - l: wu
        rp: [=nAm, =navatis, =nagaris]
  xform:
        r: zwutva(r)
        
- sutra: तोः षि
  id: 8.4.43
  overrides: 8.4.41
  condition:
      - l: tu
        r: z
  xform:
- sutra: शात्
  id: 8.4.44
  overrides: 8.4.40
  condition:
      - l: S
        r: [s, tu]
  xform:

- sutra: लोपः शाकल्यस्य
  id: 8.3.19
  condition:
     l: y
     ll: a
     r: _aS
  xform:
     l: null

- sutra: ओतो गार्ग्यस्य
  id: 8.3.20
  condition:
     l: y
     ll: o
     r: _aS
  xform:
     l: null


# Pada
- sutra: अनुस्वारस्य ययि परसवर्णः
  id: 8.4.58
  condition:
     l: M
     r: _yay
  xform:
     l: anunasika(r)

#optional at pada end
- sutra: वा पदान्तस्य
  id: 8.4.59
  overrides: 8.4.58
  optional: True
  condition:
     lp: ?pada
     l: M
     r: _yay
  xform:
     l: anunasika(r)

- sutra: मोऽनुस्वारः
  id: 8.3.23
  condition:
     l: m
     r: _hal
  xform:
     l: str("M")

- sutra: यरोऽनुनासिकेऽनुनासिको वा 
  id: 8.4.45
  optional: True
  #overrides: 8.2.39
  condition:
     l: _yar
     r: [N,Y,R,n,m]
  xform:
     l: anunasika(l)

- sutra: झलां जशोऽन्ते
  id: 8.2.39
  condition:
     lp: ?pada
     l: _Jal
     r: _aS
  xform:
     l: jashtva(l)

- sutra: खरि च
  id: 8.4.55
  condition:
     l: _Jal
     r: _Kar
  xform:
     l: chartva(l)
     
# Fixme: handle savarna of n - भवान् + लिखति = भवाल्ँलिखति । 
- sutra: तोर्लि
  id: 8.4.60
  overrides: 8.2.39
  condition:
     l: tu
     r: l
  xform:
     l: r
     
- sutra: ङमोः ह्रस्वादचि ङमुण् नित्यम्
  id: 8.3.32
  condition:
     ll: [at, it, ut, ft]
     l: _Nam
     r: _ac
  xform:
     r: l+r

- sutra: झयो होऽन्यतरस्याम्
  optional: True
  id: 8.4.62
  condition:
     l: _Jay
     r: h
  xform:
     r: vargatritiya(l)


# vartikam छत्वममि इति वक्तव्यम् incorprated
- sutra: शश्छोऽटि
  id: 8.4.63
  optional: True
  condition:  
     l: _Jay
     r: S
     rr: _am
  xform:
     r: str("C")

# Fixme Optional
# Pada
# Fixme - Pratyaya Agama
# - sutra: शि तुक्
#   id: 8.3.31
#   condition:
#      l: n
#      r: S
#   xform:
#      r: str("t")+r

# "Visarga" Sandhi
- sutra: ससजुषो रुः
  id: 8.2.66
  overrides: 8.2.39
  condition:  
     l: s
  xform:
     l: str("r")
  update:
     lp: +ru

- sutra: अतो रोरप्लुतादप्लुते
  id: 6.1.113
  overrides: 8.3.17
  condition:  
     lp: ?ru
     #l: r
     ll: at
     r: at
  xform:
     # FIXME: change this to "u" when sliding windows are done
     l: str("o")
     lc: lc[:-1]

- sutra: हशि च
  id: 6.1.114
  overrides: 8.3.17
  condition:  
     lp: ?ru
     #l: r
     ll: at
     r: _haS
  xform:
     # FIXME: change this to "u" when sliding windows are done
     l: str("o")
     lc: lc[:-1]

- sutra: भोभगोअघोअपूर्वस्य योऽशि
  id: 8.3.17
  condition:
     - ll: a
       #l:  r
       lp: ?ru
       r: _aS
     - lc: [=Bo, =Bago, =aGo]
       #l:  r
       lp: ?ru
       r: _aS
  xform:
     l: str("y")

- sutra: खरवसानयोर्विसर्जनीयः
  id: 8.3.15
  condition:
     - l:  r
       r: _Kar
       lp: ?pada
     - l:  r
       lp: ?avasAna
  xform:
     l: str("H")
     
- sutra: विसर्जनीयस्य सः
  id: 8.3.34
  condition:
     l:  H
     r: _Kar
     lp: ?pada
  xform:
     l: str("s")
     
- sutra: शर्परे विसर्जनीयः
  id: 8.3.35
  overrides: 8.3.34
  condition:
     l:  H
     r: _Kar
     rr: _Sar
     lp: ?pada

- sutra: वा शरि
  id: 8.3.36
  overrides: 8.3.34
  optional: True
  condition:
     l:  H
     r: _Sar
     lp: ?pada
  xform:
     l: str("s")

# FIXME: Ignoring updaDmanIya and jihvAmUlIya as they're not seen in practice
- sutra: कुप्वोः ≍क≍पौ च
  id: 8.3.37
  overrides: 8.3.34
  condition:
     l:  H
     r: [ku, pu]
     lp: ?pada
  xform:
     l: l
 
